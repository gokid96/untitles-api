<?xml version="1.0" encoding="UTF-8"?>
<!--
    AntiSamy Policy for Tiptap Editor Content
    노트 에디터에서 사용하는 HTML 태그만 허용
-->
<anti-samy-rules xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                 xsi:noNamespaceSchemaLocation="antisamy.xsd">

    <directives>
        <directive name="omitXmlDeclaration" value="true"/>
        <directive name="omitDoctypeDeclaration" value="true"/>
        <directive name="maxInputSize" value="500000"/>
        <directive name="useXHTML" value="true"/>
        <directive name="formatOutput" value="false"/>
        <directive name="embedStyleSheets" value="false"/>
    </directives>

    <common-regexps>
        <regexp name="htmlTitle" value="[a-zA-Z0-9\s\-_',:\[\]!\./\\\(\)&amp;]*"/>
        <regexp name="onsiteURL" value="([\p{L}\p{N}\\\.\#@\$%\+&amp;;\-_~,\?=/!]+|\#(\w)+)"/>
        <regexp name="offsiteURL" value="(\s)*((ht|f)tp(s?)://|mailto:)[A-Za-z0-9]+[~a-zA-Z0-9/\\.@#$%&amp;;:=_\-\+\?\(\)]*(\s)*"/>
        <regexp name="number" value="(-|\+)?([0-9])+"/>
        <regexp name="numberOrPercent" value="(\d)+(%{0,1})"/>
        <regexp name="colorName" value="(aqua|black|blue|fuchsia|gray|grey|green|lime|maroon|navy|olive|purple|red|silver|teal|white|yellow)"/>
        <regexp name="colorCode" value="(#([0-9a-fA-F]{6}|[0-9a-fA-F]{3}))"/>
        <regexp name="rgbCode" value="rgb\(([0-9]{1,3}),([0-9]{1,3}),([0-9]{1,3})\)"/>
    </common-regexps>

    <common-attributes>
        <attribute name="class">
            <regexp-list>
                <regexp value="[a-zA-Z0-9\s\-_]+"/>
            </regexp-list>
        </attribute>
        <attribute name="id">
            <regexp-list>
                <regexp value="[a-zA-Z0-9\-_]+"/>
            </regexp-list>
        </attribute>
        <attribute name="style">
            <regexp-list>
                <regexp value="[^()]*"/>
            </regexp-list>
        </attribute>
        <attribute name="href">
            <regexp-list>
                <regexp name="onsiteURL"/>
                <regexp name="offsiteURL"/>
            </regexp-list>
        </attribute>
        <attribute name="src">
            <regexp-list>
                <regexp name="onsiteURL"/>
                <regexp name="offsiteURL"/>
            </regexp-list>
        </attribute>
        <attribute name="alt">
            <regexp-list>
                <regexp value="[a-zA-Z0-9\s\.\-_]*"/>
            </regexp-list>
        </attribute>
        <attribute name="title">
            <regexp-list>
                <regexp name="htmlTitle"/>
            </regexp-list>
        </attribute>
        <attribute name="target">
            <literal-list>
                <literal value="_blank"/>
                <literal value="_self"/>
            </literal-list>
        </attribute>
        <attribute name="rel">
            <literal-list>
                <literal value="noopener"/>
                <literal value="noreferrer"/>
                <literal value="noopener noreferrer"/>
            </literal-list>
        </attribute>
        <attribute name="data-type">
            <regexp-list>
                <regexp value="[a-zA-Z0-9\-_]+"/>
            </regexp-list>
        </attribute>
        <attribute name="data-checked">
            <literal-list>
                <literal value="true"/>
                <literal value="false"/>
            </literal-list>
        </attribute>
        <attribute name="colspan">
            <regexp-list>
                <regexp name="number"/>
            </regexp-list>
        </attribute>
        <attribute name="rowspan">
            <regexp-list>
                <regexp name="number"/>
            </regexp-list>
        </attribute>
    </common-attributes>

    <global-tag-attributes>
        <attribute name="class"/>
        <attribute name="id"/>
        <attribute name="style"/>
        <attribute name="title"/>
    </global-tag-attributes>

    <tags-to-encode>
        <tag>g</tag>
        <tag>grin</tag>
    </tags-to-encode>

    <tag-rules>
        <!-- 기본 텍스트 서식 -->
        <tag name="p" action="validate"/>
        <tag name="br" action="validate"/>
        <tag name="span" action="validate"/>
        <tag name="div" action="validate"/>
        
        <!-- 텍스트 스타일 -->
        <tag name="strong" action="validate"/>
        <tag name="b" action="validate"/>
        <tag name="em" action="validate"/>
        <tag name="i" action="validate"/>
        <tag name="u" action="validate"/>
        <tag name="s" action="validate"/>
        <tag name="strike" action="validate"/>
        <tag name="mark" action="validate"/>
        <tag name="sub" action="validate"/>
        <tag name="sup" action="validate"/>
        
        <!-- 제목 -->
        <tag name="h1" action="validate"/>
        <tag name="h2" action="validate"/>
        <tag name="h3" action="validate"/>
        <tag name="h4" action="validate"/>
        <tag name="h5" action="validate"/>
        <tag name="h6" action="validate"/>
        
        <!-- 리스트 -->
        <tag name="ul" action="validate">
            <attribute name="data-type"/>
        </tag>
        <tag name="ol" action="validate"/>
        <tag name="li" action="validate">
            <attribute name="data-checked"/>
        </tag>
        
        <!-- 링크 -->
        <tag name="a" action="validate">
            <attribute name="href"/>
            <attribute name="target"/>
            <attribute name="rel"/>
        </tag>
        
        <!-- 이미지 -->
        <tag name="img" action="validate">
            <attribute name="src"/>
            <attribute name="alt"/>
        </tag>
        
        <!-- 인용구 -->
        <tag name="blockquote" action="validate"/>
        
        <!-- 코드 -->
        <tag name="code" action="validate"/>
        <tag name="pre" action="validate"/>
        
        <!-- 구분선 -->
        <tag name="hr" action="validate"/>
        
        <!-- 테이블 -->
        <tag name="table" action="validate"/>
        <tag name="thead" action="validate"/>
        <tag name="tbody" action="validate"/>
        <tag name="tr" action="validate"/>
        <tag name="th" action="validate">
            <attribute name="colspan"/>
            <attribute name="rowspan"/>
        </tag>
        <tag name="td" action="validate">
            <attribute name="colspan"/>
            <attribute name="rowspan"/>
        </tag>
        
        <!-- 체크리스트용 -->
        <tag name="label" action="validate"/>
        <tag name="input" action="remove"/>
    </tag-rules>

    <css-rules>
        <property name="text-align">
            <literal-list>
                <literal value="left"/>
                <literal value="center"/>
                <literal value="right"/>
                <literal value="justify"/>
            </literal-list>
        </property>
        <property name="color">
            <regexp-list>
                <regexp name="colorName"/>
                <regexp name="colorCode"/>
                <regexp name="rgbCode"/>
            </regexp-list>
        </property>
        <property name="background-color">
            <regexp-list>
                <regexp name="colorName"/>
                <regexp name="colorCode"/>
                <regexp name="rgbCode"/>
            </regexp-list>
        </property>
        <property name="font-weight">
            <literal-list>
                <literal value="normal"/>
                <literal value="bold"/>
                <literal value="bolder"/>
                <literal value="lighter"/>
            </literal-list>
            <regexp-list>
                <regexp name="number"/>
            </regexp-list>
        </property>
        <property name="font-style">
            <literal-list>
                <literal value="normal"/>
                <literal value="italic"/>
            </literal-list>
        </property>
        <property name="text-decoration">
            <literal-list>
                <literal value="none"/>
                <literal value="underline"/>
                <literal value="line-through"/>
            </literal-list>
        </property>
    </css-rules>

</anti-samy-rules>
